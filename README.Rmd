---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# Palinsol

R package to compute Incoming Solar Radiation (insolation) for paleoclimate studies.
Features three solutions: BER78, BER90 and LA04. Computes hourly, daily-mean, season-averaged and annual means for all latitudes.

<!-- badges: start -->
`r badger::badge_cran_release("palinsol", color = "")`
`r badger::badge_cran_download("palinsol", "last-month", color = "blue")`
`r badger::badge_devel("special-uor/palinsol", color = "yellow")`
`r badger::badge_github_actions("special-uor/palinsol")`
<!-- badges: end -->

## Installation

You can install the released version of palinsol from [CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("palinsol")
```

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("special-uor/palinsol")
```

## Example

### Calculation of orbital parameters
The function `astro` can be used to find the orbital paraters. This function takes three arguments:

- `t`:            time, years after 1950.
- `solution`:	    solution used. One of `palinsol::ber78` (Berger, 1978), `palinsol::ber90` (Berger and Loutre, 1991) or `palinsol::la04` (Laskar, 2004).
- `degree`:	      returns angles in degrees if `TRUE`.

For example to find the orbital parameters for the last 100k years with 1k years resolution:

```{r}
# Load the pipe operator from `magrittr`
`%>%` <- magrittr::`%>%`

# Create sequence (vector) with years
years <- seq(from = -10^5, to = 0, by = 1000)

# Find orbital parameters
orb_param <- years %>%
  purrr::map_df(palinsol::astro, solution = palinsol::ber78, degree = TRUE)

# Append the years to the table with the orbital parameters
orb_param <- orb_param %>%
  dplyr::mutate(year = years, .before = 1)

# Print table with the first 10 rows
orb_param %>%
  dplyr::slice(1:10) %>%
  knitr::kable()
```

Create plots for all the variables
```{r, dpi = 500}
orb_param %>%
  tidyr::pivot_longer(cols = c(eps, ecc, varpi, epsp),
                      names_to = "var") %>%
  ggplot2::ggplot(ggplot2::aes(year, value)) +
  ggplot2::geom_point() +
  ggplot2::geom_line() +
  ggplot2::facet_wrap(facets = ~var, 
                      scales = "free",
                      labeller = ggplot2::labeller(var = c("ecc" = "Obliquity (ecc)",
                                                           "eps" = "Eccentricity (eps)",
                                                           "varpi" = "True Solar Longitude of the Perihelion (varpi)",
                                                           "epsp" = "(epsp)"))) +
  ggplot2::theme_bw()
```
